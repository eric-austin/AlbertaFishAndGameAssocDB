CREATE DATABASE AFGA;

USE AFGA;

CREATE TABLE Member (
	MemNo	INT(8) AUTO_INCREMENT PRIMARY KEY,
	FName	VARCHAR(30) NOT NULL,
	LName	VARCHAR(30)	NOT NULL,
	Gender	ENUM('MALE','FEMALE') DEFAULT NULL,
	Phone	VARCHAR(11) DEFAULT NULL,
	Email	VARCHAR(30) DEFAULT NULL,
	Type	ENUM('INDIVIDUAL','FAMILY')	NOT NULL DEFAULT 'INDIVIDUAL'
);

CREATE TABLE Club (
	City 	VARCHAR(30) PRIMARY KEY,
	Address	VARCHAR(30),
	NumMemb	INT NOT NULL DEFAULT 0
);

CREATE TABLE MemberCard (
	MemNo	INT(8) PRIMARY KEY,
	Club	VARCHAR(30) NOT NULL,
	ExpDate	DATE,
	FOREIGN KEY (MemNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (Club) REFERENCES Club(City)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Incident (
	IncidentNum		INT(8) AUTO_INCREMENT PRIMARY KEY,
	Date			DATE NOT NULL,
	ReporterName	VARCHAR(60) NOT NULL,
	EmergencyFlag	BOOLEAN NOT NULL DEFAULT FALSE,
	ViolationFlag	BOOLEAN NOT NULL DEFAULT FALSE,
	OtherFlag		BOOLEAN NOT NULL DEFAULT TRUE,
	Club			VARCHAR(30) NOT NULL,
	FOREIGN KEY (Club) REFERENCES Club(City)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Cause (
	MemNo	INT(8) NOT NULL,
	Club	VARCHAR(30) NOT NULL,
	IncidentNum	INT(8) NOT NULL,
	PRIMARY KEY (MemNo, Club, IncidentNum),
	FOREIGN KEY (MemNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (Club) REFERENCES Club(City)
			ON DELETE CASCADE	ON UPDATE CASCADE
	FOREIGN KEY (Incident) REFERENCES Incident(IncidentNum)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Guardians (
	MemNo	INT(8) NOT NULL,
	Name	VARCHAR(60) NOT NULL,
	Phone	VARCHAR(11) NOT NULL,
	PRIMARY KEY (MemNo, Name, Phone),
	FOREIGN KEY (MemNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE DependsOn (
	HeadNo		INT(8) NOT NULL,
	SpouseNo	INT(8) NOT NULL,
	DependentNo	INT(8) NOT NULL,
	PRIMARY KEY (HeadNo, SpouseNo, DependentNo),
	FOREIGN KEY (HeadNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE 	ON UPDATE CASCADE,
	FOREIGN KEY (SpouseNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE 	ON UPDATE CASCADE,
	FOREIGN KEY (DependentNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE 	ON UPDATE CASCADE
);

CREATE TABLE Newsletter (
	IssueNo		INT(8) AUTO_INCREMENT PRIMARY KEY,
	NumOfSubs	INT(8) NOT NULL DEFAULT 0
);

CREATE TABLE SubscribesTo (
	MemNo	INT(8) NOT NULL,
	IssueNo	INT(8) NOT NULL,
	PRIMARY KEY (MemNo, IssueNo),
	FOREIGN KEY (MemNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (IssueNo) REFERENCES Newsletter(IssueNo)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE FiringRange (
	Latitude 	FLOAT NOT NULL,
	Longitude	FLOAT NOT NULL,
	Club		VARCHAR(30) NOT NULL,
	PRIMARY KEY (Latitude, Longitude, Club),
	FOREIGN KEY (Club) REFERENCES Club(City)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE PracticeAt (
	Latitude 	FLOAT NOT NULL,
	Longitude	FLOAT NOT NULL,
	MemNo		INT(8) NOT NULL,
	PRIMARY KEY (Latitude, Longitude, MemNo),
	FOREIGN KEY (Latitude, Longitude) REFERENCES FiringRange(Latitude, Longitude)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (MemNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Event (
	Name	VARCHAR(30)	NOT NULL,
	Date	DATE NOT NULL,
	City	VARCHAR(30),
	Street	VARCHAR(30),
	Club	VARCHAR(30) NOT NULL,
	PRIMARY KEY (Name, Date),
	FOREIGN KEY (Club) REFERENCES Club(City)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Attends (
	EventName	VARCHAR(30) NOT NULL,
	EventDate	DATE NOT NULL,
	MemNo		INT(8) NOT NULL,
	PRIMARY KEY (EventName, EventDate, MemNo),
	FOREIGN KEY (EventName, EventDate) REFERENCES Event(Name, Date)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (MemNo) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Animal (
	TagNo		INT(8) PRIMARY KEY,
	Weight		FLOAT DEFAULT NULL,
	Species		VARCHAR(30) NOT NULL,
	Gender		ENUM('MALE','FEMALE') DEFAULT NULL,
	Type		ENUM('MAMMAL','BIRD','FISH','OTHER') DEFAULT NULL,
	Hunter		INT(8) NOT NULL,
	WeaponUsed	VARCHAR(30) DEFAULT NULL,
	FOREIGN KEY (Hunter) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE
);

CREATE TABLE Prize (
	PrizeName	VARCHAR(30) NOT NULL,
	Member		INT(8) NOT NULL,
	EventName	VARCHAR(30) NOT NULL,
	EventDate	DATE NOT NULL,
	Animal		INT(8) NOT NULL,
	PRIMARY KEY (PrizeName, Member, EventName, EventDate, Animal),
	FOREIGN KEY (Member) REFERENCES Member(MemNo)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (Animal) REFERENCES Animal(TagNo)
			ON DELETE CASCADE	ON UPDATE CASCADE,
	FOREIGN KEY (EventName, EventDate) REFERENCES Event(Name, Date)
			ON DELETE CASCADE	ON UPDATE CASCADE
);